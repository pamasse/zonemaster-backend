ARG IMAGE_NAME="ubuntu:latest"
FROM $IMAGE_NAME

ENV DEBIAN_FRONTEND noninteractive


# Install a couple dependencies + extra packages
RUN apt-get update --fix-missing -qq && apt-get install -qq \
    apt-utils \
    build-essential \
    curl \
    gcc \
    git \
    gpp \
    locales \
    libncurses5-dev \
    libreadline-dev \
    libssl-dev

# Set the locale
RUN echo "fr_FR.UTF-8 UTF-8" > /etc/locale.gen && \
    locale-gen fr_FR.UTF-8 && \
    dpkg-reconfigure locales && \
    /usr/sbin/update-locale LANG=fr_FR.UTF-8
ENV LC_ALL fr_FR.UTF-8  

ARG PERL_VERSION 

# Installation of the right PERL version
ENV PERLBREW_ROOT=/perl5

RUN curl -L https://install.perlbrew.pl | bash && \
		/perl5/bin/perlbrew init &&\
		/perl5/bin/perlbrew install -j 4 -n perl-$PERL_VERSION --switch  &&\
        /perl5/bin/perlbrew install-cpanm
        
ENV PERLBREW_ROOT=/perl5 \
	PATH=/perl5/bin:/perl5/perls/perl-$PERL_VERSION/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \
	PERLBREW_PERL=perl-$PERL_VERSION \
	PERLBREW_MANPATH=/perl5/perls/perl-$PERL_VERSION/man \
	PERLBREW_PATH=/perl5/bin:/perl5/perls/perl-$PERL_VERSION/bin \
	PERLBREW_SKIP_INIT=1

RUN /perl5/bin/perlbrew off && apt-get install -qq --no-install-recommends software-properties-common postgresql-client-$DB_VERSION && \
    apt-get install -qq --no-install-recommends postgresql-$DB_VERSION
RUN cpanm DBD::Pg 
